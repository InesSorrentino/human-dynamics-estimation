cmake_minimum_required(VERSION 3.0)
project(human-viz-bridge-yarp)

set (CMAKE_CXX_STANDARD 11)

yarp_idl_to_dir("${CMAKE_CURRENT_SOURCE_DIR}/thrift/XsensFrame.thrift" "${CMAKE_CURRENT_BINARY_DIR}/autogenerated/data" THRIFT_SOURCES THRIFT_HEADERS THRIFT_INCLUDE_DIRS)
yarp_idl_to_dir("${CMAKE_CURRENT_SOURCE_DIR}/thrift/XsensDriverService.thrift" "${CMAKE_CURRENT_BINARY_DIR}/autogenerated/services" THRIFT_SERVICE_SOURCES THRIFT_SERVICE_HEADERS THRIFT_SERVICE_INCLUDE_DIRS)

add_library(human-viz-bridge-yarp-thrift STATIC ${THRIFT_SOURCES}
                                                ${THRIFT_HEADERS}
                                                ${THRIFT_SERVICE_SOURCES}
                                                ${THRIFT_SERVICE_HEADERS})

target_link_libraries(human-viz-bridge-yarp-thrift ${YARP_LIBRARIES})
target_include_directories(human-viz-bridge-yarp-thrift PUBLIC ${THRIFT_INCLUDE_DIRS}
                                                               ${THRIFT_SERVICE_INCLUDE_DIRS})

# TF bridge
add_executable(human-tf-bridge src/HumanTFBridge.cpp)

if (MSVC)
  target_compile_definitions(human-tf-bridge PRIVATE -D_USE_MATH_DEFINES)
endif ()

add_warnings_configuration_to_target(TARGETS human-tf-bridge PRIVATE)

target_link_libraries(human-tf-bridge YARP::YARP_OS
                                      YARP::YARP_dev
                                      iDynTree::idyntree-model
                                      iDynTree::idyntree-modelio-urdf
                                      human-viz-bridge-yarp-thrift
                                      human-rosmsgs)

list(APPEND conf config/human-tf-bridge.ini)

# Joints bridge

add_executable(human-jointstate-bridge src/HumanJointStateBridge.cpp)

if (MSVC)
  target_compile_definitions(human-jointstate-bridge PRIVATE -D_USE_MATH_DEFINES)
endif ()

add_warnings_configuration_to_target(TARGETS human-jointstate-bridge PRIVATE)

target_link_libraries(human-jointstate-bridge YARP::YARP_OS
                                              YARP::YARP_dev
                                              iDynTree::idyntree-core
                                              iDynTree::idyntree-model
                                              iDynTree::idyntree-modelio-urdf
                                              human-viz-bridge-yarp-thrift
                                              human-rosmsgs
                                              human-state-provider-data)

list(APPEND conf config/human-jointstate-bridge.ini)

# Effort bridge

add_executable(human-effort-bridge src/HumanEffortBridge.cpp)

if (MSVC)
  target_compile_definitions(human-effort-bridge PRIVATE -D_USE_MATH_DEFINES)
endif ()

target_link_libraries(human-effort-bridge YARP::YARP_OS
                                          YARP::YARP_dev
                                          iDynTree::idyntree-model
                                          iDynTree::idyntree-modelio-urdf
                                          human-viz-bridge-yarp-thrift
                                          human-rosmsgs
                                          human-state-provider-data
                                          human-dynamics-estimator-data)

list(APPEND conf config/human-effort-bridge.ini)


# Robot Base pose provider

add_executable(robot-basepose-publisher src/RobotBasePosePublisher.cpp)

if (MSVC)
  target_compile_definitions(robot-basepose-publisher PRIVATE -D_USE_MATH_DEFINES)
endif ()

target_link_libraries(robot-basepose-publisher YARP::YARP_OS
                                               YARP::YARP_dev
                                               iDynTree::idyntree-high-level
                                               iDynTree::idyntree-model
                                               iDynTree::idyntree-modelio-urdf
                                               human-viz-bridge-yarp-thrift
                                               human-rosmsgs
                                               human-state-provider-data
                                               human-dynamics-estimator-data)

target_include_directories(robot-basepose-publisher PUBLIC ${EIGEN3_INCLUDE_DIR})

list(APPEND conf config/robot-basepose-publisher.ini)

yarp_install(FILES ${conf} DESTINATION ${YARP_CONTEXTS_INSTALL_DIR}/human-dynamic-estimation)

install(TARGETS human-tf-bridge
                human-jointstate-bridge
                human-effort-bridge
                robot-basepose-publisher
                RUNTIME DESTINATION ${CMAKE_INSTALL_FULL_BINDIR}
                ARCHIVE DESTINATION ${CMAKE_INSTALL_FULL_LIBDIR}
                LIBRARY DESTINATION ${CMAKE_INSTALL_FULL_LIBDIR})
